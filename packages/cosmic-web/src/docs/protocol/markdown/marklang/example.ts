import {Component} from 'san';
import './example.less';
import marklang from 'marklang';
import 'marklang/lib/style.css';

/* eslint-disable max-len */
const referenceList = [
    {
        'vid': '8816932630209944298',
        'url': 'https://haokan.baidu.com/v?pd=wisenatural&vid=8816932630209944298',
        'type': 'text',
        'text': '谁是王默的真正妈妈?',
        'source': 'haokan.baidu.com',
        'poster': 'http://t13.baidu.com/it/u=1974181585,1878501862&fm=225&app=113&f=JPEG?w=1920&h=1076&s=6BBF0AC30835B1DC5E4C809D03007002',
        'kexin_level': '0',
        'cate': 'Authority',
        'index': 1,
        'urlParams': {
            'type': 'tc',
            'tcUrl': 'http://m.baidu.com/from=0/bd_page_type=1/ssid=0/uid=0/pu=usm%4010%2Csz%401320_2001%2Cta%40iphone_1_16.6_25_16.6/baiduid=35152AC4EF252FCDD2B255CE35CC1367/w=0_10_/t=iphone/l=1/tc?ref=www_iphone&lid=9007560108170698455&order=1&fm=alop&cyc=1&extra=%7B%22loc%22%3A%22https%253A%252F%252Fhaokan.baidu.com%252Fv%253Fpd%253Dwisenatural%2526vid%253D8816932630209944298%22%2C%22log_loc%22%3A%22https%253A%252F%252Fhaokan.baidu.com%252Fv%253Fpd%253Dwisenatural%2526vid%253D8816932630209944298%22%2C%22baijiahao_id%22%3A%221561812659283047%22%2C%22jsy%22%3A%221%22%2C%22source_trace%22%3A%22CMS_VIDEO_PUBLISH%22%2C%22nid%22%3A%228816932630209944298%22%7D&isAtom=1&clk_info=%7B%22tplname%22%3A%22wenda_index%22%2C%22srcid%22%3A%2234815%22%2C%22jumpType%22%3A%22video_jsy%22%2C%22jumpId%22%3A%22100%22%2C%22urlsign%22%3A%2215850435181738842462%22%7D&is_baidu=0&tj=9Zz_1_0_10_l1&wd=&eqid=7d014831bc7e5ed7100000056641b940&w_qd=IlPT2AEptyoA_ykyweko5BivFS2SdIon9DsXnO0Qwhe&bdver=2_1&tcplug=1&dict=-1&sec=38550&di=4fec2c9e0e813f8b&bdenc=1&nsrc=%2BCZST6jP7Nrujflz007XVCaHTM1VljBfNeSKTzuPfTX1whJwDJohV4V9MxS3eqUgCEqO%2FKINYI8VyoIfrEbtyrkqIOmoT0YekC7huh21V5IQxGXyqGoYE7mIOW%2BM2%2FBhiV1wwHoAPVAXHnkHU%2FynCQRL4M89d4So0qB1I1Mr89J3%2FgfOivN%2Fscu3ZkfSEHf7M2trHsPS%2BCBw2YddvNd01Zo8KGWS0M3bj7EfsoLRwwYAJgFDu3STFmAYKE3X%2F8iXUkNxooxoikVzhOnb3hR1n6x6shcw59cBslcftm0imP9CeqOa3sLQyHDSzCTeaYpD7AhowXuk9nzl9l0p6i9xMU%2B1GBK7CoXxIDxkYMRDIJWCaT8xLmRyrniSaQTtK7PBRT2WkqEScrRCRnsNy23s2KMwYYaCVbTXbnOMhEyBrWp8iS7Z45aooGJoPfccP%2FZL668ipdBnW2BGMdyNzmOQxERmPK%2FHZOLxMlbLknx60dQJwcZnkLdYrtnsokUs29SMTj9iu%2BiHVa9hirpq3rHBSIX7%2F%2FPjfYwqoa34zHZmBuliJjGXA5YSpyEjXCNM9x1mQHY806ugEU5W82v5nc%2B9oxHoHNYr2cUv7OaNXQemf9rMW8dQpsIQFyCKda8kzMe%2B22rjhyEEo3Kn5qDGhMnGrjp0f5FtYJkr40lsd6n6OjmugLtibq6Qqe4zs6yCSOl6aBxLmUWi9Ui2wQmWFpRhF6GmaF%2F%2Fb%2Fct9czfdt9aZN7yB2X1wFFvrR%2BLK6AKrxb99sWnadXsOAcQL2KJS0k5Uc%2BI3woxsFwftt%2B8r1wMuBtDzOxe2l9j9NsaH5RZNbDWLTI2eIZh1JQcUonyZ2pIfg%3D%3D',
            'originUrl': 'http://sefe-f1.bcc-bdbl.baidu.com:8197/video/page?pd=video_page&nid=8816932630209944298&sign=11218893312176137556&word=%E7%8E%8B%E9%BB%98%E7%9A%84%E5%A6%88%E5%A6%88%E6%98%AF%E8%B0%81&oword=%E7%8E%8B%E9%BB%98%E7%9A%84%E5%A6%88%E5%A6%88%E6%98%AF%E8%B0%81&atn=index&frsrcid=34815&ext=%7B%22jsy%22%3A1%7D&top=%7B%22sfhs%22%3A1%2C%22_hold%22%3A2%7D&fr0=A&fr1=A&ms=1&lid=9007560108170698455&referlid=9007560108170698455&frorder=1',
            'log': '{\'commonLog\':{\'clkInfo\':{\'urlsign\':\'15850435181738842462\'}},\'e\':\'IlPT2AEptyoA_yixCFOxXnANedT62v3IFR3XMGFSQ8SwnkrqePThHBhcYzbrRTWZHEiwd94WsBYGtXLRKT6yj1tOrxoogjxqznqPt_jhg_H1V1B1s_wo_dXHDXBuzuXqyKpObNx5Qt5yB7tcybS9rtJqvcXNcMYf7wzMtiumqse1YY47WlO2nVjj1F5EDC_uCufIdtaoqzx9WkzdAO3hHoDxr7NHFCgPfAna9dNZOtT9pm-oLu8VIsFOWFSYNS-cW0fgTNSLoRPZXpJYmCNU4mF_9Ejmdu3JG8VBWhftyO97J1KFExr4GIGKLBsiuR3MGL1fDLDHmtxiPmoWaldjUpkFMvGzOzWGDpEOUru-bLynDFhinl47Rr3fnY2sCvKu_McZ3xgCH8kHm6ncnNTOrIaqKw3KrAA0G0xqOSvmjlx4ynkqPlCe6EnX9FYGbzLQ37rLN8KWEhKT3zwjkc0FMaGR1R7DXWp4mnelpYiluSyBVceJRfMSwIxrklEJ3oisvavhM7esTQ3z8QMM-1L1z_rb8iDirojkiprLIOLSKu17Ak1hvxQrPGelf6jtypVsU2XKiDCYTW38riccpuv5uSEDxcUuDqEuCNWfNcZpwOD8xV6iHU1UcgDETrAQA6a8jekVZPGgG7atVouH0HN9nNBdUWC0MyOXj3_OEYQ5QmTl0mCwRchncWEchm2yCazdS77l5e10EonwbAJQDdfSw6oZ_AkGNpF-lU79TSmeO_m3cbETkX68frtQPUyt0vDVu7AcfsAP2-_rgwelPQv7sT2fkyqF9tYe3xzFDkeTazGF4eAPwoaXQlnn\',\'c\':1,\'extra\':\'{\\\'loc\\\':\\\'https%3A%2F%2Fhaokan.baidu.com%2Fv%3Fpd%3Dwisenatural%26vid%3D8816932630209944298\\\',\\\'log_loc\\\':\\\'https%3A%2F%2Fhaokan.baidu.com%2Fv%3Fpd%3Dwisenatural%26vid%3D8816932630209944298\\\',\\\'baijiahao_id\\\':\\\'1561812659283047\\\',\\\'jsy\\\':\\\'1\\\',\\\'source_trace\\\':\\\'CMS_VIDEO_PUBLISH\\\',\\\'nid\\\':\\\'8816932630209944298\\\'}\'}',
            'hrsf': 1,
            'clickData': '{\'extra\':\'{\\\'component_content\\\':{\\\'component_name\\\':\\\'reference\\\'},\\\'panel_type\\\':\\\'1\\\',\\\'refer_type\\\':\\\'text\\\',\\\'panel_order\\\':\\\'0\\\'}\',\'clk_info\':{\'jumpType\':\'video_jsy\',\'jumpId\':\'100\',\'urlsign\':\'15850435181738842462\'}}',
            'options': {
                'allowPrepare': true,
                'isIos': true,
                'isAndroid': false,
                'hitIosSlrPrepare': false,
                'hitVideoPrepare': true,
                'videoExt': {
                    'playServer': {
                        'videoUrl': 'https://vd3.bdstatic.com/mda-nmdbs9bgt4ajv906/hd/cae_h264/1671010668929513691/mda-nmdbs9bgt4ajv906.mp4'
                    },
                    'playLogExtra': {
                        'loc': 'https://haokan.baidu.com/v?pd=wisenatural&vid=8816932630209944298',
                        'video_source': '',
                        'vidTypeNew': null,
                        'baijiahao_id': '1561812659283047',
                        'jsy': '1',
                        'hejiLoc': '',
                        'nid': '8816932630209944298',
                        'source_trace': 'CMS_VIDEO_PUBLISH'
                    },
                    'barrageInfo': '{\'key\':\'8816932630209944298\',\'source_type\':\'video_dm\'}'
                }
            }
        }
    },
    {
        'url': 'https://www.kuaikanmanhua.com/qa1/16753/index.html',
        'type': 'text',
        'text': '谁是王默的真正妈妈',
        'source': 'www.kuaikanmanhua.com',
        'kexin_level': '1',
        'cate': 'Authority',
        'index': 2,
        'urlParams': {
            'type': 'tc',
            'tcUrl': 'http://m.baidu.com/from=0/bd_page_type=1/ssid=0/uid=0/pu=usm%4010%2Csz%401320_2001%2Cta%40iphone_1_16.6_25_16.6/baiduid=35152AC4EF252FCDD2B255CE35CC1367/w=0_10_/t=iphone/l=1/tc?ref=www_iphone&lid=9007560108170698455&order=1&fm=alop&isAtom=1&clk_info=%7B%22tplname%22%3A%22wenda_index%22%2C%22srcid%22%3A%2234815%22%2C%22jumpType%22%3A%22%22%7D&is_baidu=0&tj=9Zz_1_0_10_l1&wd=&eqid=7d014831bc7e5ed7100000056641b940&w_qd=IlPT2AEptyoA_ykyweko5BivFS2SdIon9DsXnO0Qwhe&bdver=2_1&tcplug=1&dict=-1&sec=38550&di=4b38798bdd41b0de&bdenc=1&nsrc=%2FOPkEndSS1OxJGcxb%2BQxS4cCPuS07V15lWa4r7BTLPwLQwwSI6RcdOZoxQ7uTs%2B3Xm1V1vWiXdS8Tt5skCLr%2FN%2FQ12reImDqaKU1AlqU0PyK%2BJBvEEfH9h175B2uTKsz',
            'log': '{}',
            'hrsf': 1,
            'clickData': '{\'extra\':\'{\\\'component_content\\\':{\\\'component_name\\\':\\\'reference\\\'},\\\'panel_type\\\':\\\'1\\\',\\\'refer_type\\\':\\\'text\\\',\\\'panel_order\\\':\\\'1\\\'}\',\'clk_info\':{\'jumpType\':\'\'}}'
        }
    },
    {
        'url': 'https://baijiahao.baidu.com/s?id=1744627591257476776&wfr=spider&for=pc',
        'type': 'text',
        'text': '精灵梦叶罗丽第十季:黎灰闯祸,王默母亲“灵沫仙子”被迫回归',
        'source': 'baijiahao.baidu.com',
        'kexin_level': '2',
        'cate': 'Authority',
        'index': 3,
        'urlParams': {
            'type': 'tc',
            'tcUrl': 'http://m.baidu.com/from=0/bd_page_type=1/ssid=0/uid=0/pu=usm%4010%2Csz%401320_2001%2Cta%40iphone_1_16.6_25_16.6/baiduid=35152AC4EF252FCDD2B255CE35CC1367/w=0_10_/t=iphone/l=1/tc?ref=www_iphone&lid=9007560108170698455&order=1&fm=alop&isAtom=1&clk_info=%7B%22tplname%22%3A%22wenda_index%22%2C%22srcid%22%3A%2234815%22%2C%22jumpType%22%3A%22%22%7D&is_baidu=0&tj=9Zz_1_0_10_l1&wd=&eqid=7d014831bc7e5ed7100000056641b940&w_qd=IlPT2AEptyoA_ykyweko5BivFS2SdIon9DsXnO0Qwhe&bdver=2_1&tcplug=1&dict=-1&sec=38550&di=a73c4afeaa0666d9&bdenc=1&nsrc=w%2BwyoTGtvHmo8JtlA78lAJKOuFMPsVDMvAwYkdixDVIdYcsaW%2F2QtcScAezhyhvsgvxgfvo6euJc1GHCp%2FqgdA%2BwPpZ2iB1TIetOqvek3kniq3eyreVaMgCd7yVYQzaXVrJO97pboA6Il9pVfxXzGLHnBwEe%2BaSxP8teTfyOHMVQr%2FkBTyCqp3mMJleUaKsZNHjA3QxPZi2IrXHtAAmrhzK52Y7SQlEUZyTH8QKhfcJMqjE8RHiNPWt6hWn3OuhT',
            'originUrl': 'https://baijiahao.baidu.com/s?id=1744627591257476776&wfr=spider&for=pc&searchword=王默的妈妈是谁',
            'log': '{\'e\':\'IlPT2AEptyoA_yixCFOxCGZb8c3JV3T5ABSULCRR1z_voo3-efnbFRhdXTqqAp7JZpLPvWL0sakEx8Cf_WQl8Bl_rqdjt7wd8HbfgPrux14ACBVdv1Ex0tPUDXBu6u4gyKpOtQVoRtByMDodmOrzeRcarsSof3Yay1P9dHnFvMaEVT3JV6K1i7rpB6V7HyetGNfIh4qkuHEjDS8t2uKuCY7EvUNDJCdif0aNztJ1L33FinFn\',\'c\':\'\'}',
            'hrsf': 1,
            'clickData': '{\'extra\':\'{\\\'component_content\\\':{\\\'component_name\\\':\\\'reference\\\'},\\\'panel_type\\\':\\\'1\\\',\\\'refer_type\\\':\\\'text\\\',\\\'panel_order\\\':\\\'2\\\'}\',\'clk_info\':{\'jumpType\':\'\'}}'
        }
    }
];
const text = "---\n### 自定义属性测试：\n[链接自定义属性](http://www.baidu.com){sa='123' o='123'}\n我是普通链接[www.baidu.com](https://www.baidu.com)[010-8888888](tel:010-888888)链接，自动识别为跳转链接https://www.baidu.com\n";
const coreAnswerSup = '**带标记的文本:**\n## ==短答案==\n==**核心答案**==\n';
const katexText = '**数学公式：**\n行内公式：$450 / 500 \\times 100\\% = 90\\%$，所以，450是500的90%，即90%。\n块级公式: \n$$\n  A(n,m) = n \\times (n-1) \\times (n-2) \\times \\cdots \\times (n-m+1) = \\frac{n!}{(n-m)!}\n  $$\n\n';
const codeText = "**代码块：**\n我测试`some word code`测试\n```javascript\n// Using ES6 import syntax\nimport pandas as pd\n// load the library and ALL languages\nconst hljs = require('highlight.js');\nenum TYPE = 1;\nvar reg = /^http:/g;\nconsole.log(hljs, reg);\n```\n\n";
const img = ":::ml-brief\n![](https://eb118-file.cdn.bcebos.com/upload/394DB6209D2B661F0CABD3D836C1BCC9?x-bce-process=style/wm_ai){width='100' height='100'} :ml-title[title]\n这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本这是一长串文本\n:::\n";
const list = '**有序列表和无序列表：**\n 1. 这是一级列表这是一级列表这是一级列表这是一级列表这是一级列表这是一级列表\n    1. 这是二级子列表这是二级子列表这是二级子列表\n    2. 这是子列表\n2. 第二行列表项\n3. 第三行列表项\n2. 第二行列表项\n3. 第三行列表项\n2. 第二行列表项\n3. 第三行列表项\n2. 第二行列表项\n    1. 这是子列表\n3. 第三行列表项\n2. 第二行列表项\n    1. 这是子列表\n    2. 这是子列表\n    - 这是子列表\n3. 第三行列表项\n2. 第二行列表项\n3. 第三行列表项\n2. 第二行列表项\n3. 第三行列表项\n2. 第二行列表项\n3. 第三行列表项\n2. 第二行列表项\n\n';
const table = '**普通表格**：\n\n查询全网结果，绍兴市居民用水，根据不同的用水量略有不同，具体如下：\n\n|用水量|到户价|明细|\n|-|-|-|\n|第一级用水量（每户每月20立方米及以下用水量）||供水价格1.8元/立方米<br>污水处理费0.95元/立方米|\n|第二级用水量（每户每月21到30立方米的用水量）|3.65元/立方米|供水价格1.8元/立方米<br>污水处理费0.95元/立方米|\n|^|4.55元/立方米|供水价格3.6元/立方米<br>污水处理费0.95元/立方米|\n\n如果你需要了解更多信息，可以访问绍兴水网上营业厅\n';
const collaspeTable = '**合并单元格表格**：\n\n|项目|>|年利率（%）|\n| :---: | :---: | :---: |\n|一、个人住房公积金存款|>|1|\n|当年缴存|>|1.5|\n|上年结转|>|1.5|\n|二、个人住房公积金贷款|>|1|\n|首套|五年以下（含五年）|2.6|\n|^|五年以上|3.1|\n|第二套|五年以下（含五年）|不低于3.025|\n|^|>|五年以上|\n\n';
const citation = "**自定义指令：**\n:::ml-container\n容器内部可以包含块级指令\n::ml-block[这是一个块级元素]\n也可以包含内联指令，比如:ml-tts[播报]{text=1}\n:::\n\n:ml-citation[溯源1]{data='data1'}\n";
const inlineDirective = "这是一个文本:tts,这是一个指令:ml-tts[播报]{textName='ttsName' text=2}测试结束。\n";
const footnote = 'footnote测试[^1]\n[^1]: Big note.\n';
const citationData = marklang.dataToSource('data1', referenceList);
const allText = text + coreAnswerSup + katexText + codeText + img + list + table + collaspeTable + citation + inlineDirective + footnote + citationData;
const directives = {
    'ml-tts': (node, dom) => {
        console.log('marklang example tts node: ', node, dom);
        const span = document.createElement('span');
        span.style = 'color: red;';
        span.textContent = node.content;
        return span;
    },
    'ml-citation': (node, dom) => {
        console.log('marklang example ml-citation node: ', node, dom);
        const span = document.createElement('span');
        span.textContent = node.content;
        return span;
    },
    'ml-container': (node, dom) => {
        console.log('marklang example ml-container node: ', node, dom);
        return dom;
    }
};
const options = {
    autolink: true,
    directives,
    transformers: {
        mdast: {
            link: ({node}) => {
                console.log('marklang example', node.url);
            }
        }
    }
};

export default class MarklangExample extends Component {
    static template = /* html */ `
        <div class='example-container'>
            <div class='left'>
                <textarea value='{= inputText =}' on-input='handleInput' placeholder='add multiple lines' />
            </div>
            <div class='right'>
                <p class='title'>渲染结果：</p>
                <div s-ref='mdRef'></div>
            </div>
        </div>
    `;

    initData() {
        return {
            inputText: ''
        };
    }
    attached(): void {
        this.data.set('inputText', allText);
        marklang(options).renderToElement(allText, this.ref('mdRef'));
    }
    handleInput = () => {
        const inputText = this.data.get('inputText');
        if (inputText) {
            const text = inputText.replace(/\\n/g, '\n');
            marklang(options).renderToElement(text, this.ref('mdRef'));
        }
        else {
            marklang(options).renderToElement(inputText.value, this.ref('mdRef'));
        }
    };
}
